<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="mypageMapper">

	<resultMap id="boardResultSet" type="board">
		<result column="BOARD_NO" property="boardNo" />
		<result column="BOARD_TITLE" property="boardTitle" />
		<result column="MEMBER_ID" property="memberId" />
		<result column="BOARD_VIEW" property="boardView" />
		<result column="BOARD_DATE" property="boardDate" />
		<result column="ORIGIN_NAME" property="originName" />

		<result column="BOARD_CONTENT" property="boardContent" />

		<result column="CHANGE_NAME" property="changeName" />
		<result column="BOARD_REPLY_COUNT" property="replyCount" />
	</resultMap>

	<resultMap id="findResultSet" type="find">
		<result column="FIND_NO" property="findNo" />
		<result column="FIND_TITLE" property="findTitle" />
		<result column="FIND_CATEGORY" property="findCategory" />
		<result column="MEMBER_ID" property="memberId" />
		<result column="FIND_VIEW" property="findView" />
		<result column="FIND_DATE" property="findDate" />
		<result column="ORIGIN_NAME" property="originName" />

		<result column="FIND_COTENT" property="findContent" />
		<result column="CHANGE_NAME" property="changeName" />
		<result column="FIND_REPLY_COUNT" property="replyCount" />
	</resultMap>
	

	<!-- 자유게시판 게시글 갯수 -->
	<select id="selectBoardListCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		WHERE STATUS = 'Y'
		AND MEMBER_ID = #{memberId}
	</select>

	<!-- 게시글 리스트를 구해주는 쿼리문 -->
	<select id="selectBoardList" parameterType="string"
		resultMap="boardResultSet">
		SELECT
		B.BOARD_NO,
		B.BOARD_TITLE,

		B.BOARD_CONTENT,

		B.BOARD_VIEW,
		B.BOARD_DATE,
		B.STATUS,
		B.MEMBER_ID,
		BA.ORIGIN_NAME,
		BA.CHANGE_NAME,
		COUNT(BR.BRE_NO) AS BOARD_REPLY_COUNT
		FROM BOARD B

		JOIN
		MEMBER M ON
		(M.MEMBER_ID = B.MEMBER_ID)
		LEFT JOIN BATTACHMENT BA ON
		(BA.BOARD_NO =
		B.BOARD_NO)
		LEFT JOIN BOARD_REPLY BR ON (BR.BOARD_NO =
		B.BOARD_NO)

		WHERE B.STATUS = 'Y'
		AND M.MEMBER_ID = #{memberId}
		GROUP BY
		B.BOARD_NO,
		B.BOARD_TITLE,

		B.BOARD_CONTENT,

		B.BOARD_VIEW,
		B.BOARD_DATE,
		B.STATUS,
		B.MEMBER_ID,
		BA.ORIGIN_NAME,
		BA.CHANGE_NAME

		ORDER BY B.BOARD_NO
		DESC

	</select>

	<select id="selectFindListCount" resultType="_int">
		SELECT COUNT(*)
		FROM FIND
		WHERE STATUS = 'Y'
		AND MEMBER_ID = #{memberId}
	</select>


	<!-- 게시글 리스트를 구해주는 쿼리문 -->
	<select id="selectFindList" resultMap="findResultSet">

		SELECT
		F.FIND_NO,
		F.FIND_TITLE,

		F.FIND_CONTENT,

		F.FIND_CATEGORY,
		F.FIND_VIEW,
		F.FIND_DATE,
		F.STATUS,
		F.MEMBER_ID,
		FA.ORIGIN_NAME,
		FA.CHANGE_NAME,

		COUNT(FR.FRE_NO) AS
		FIND_REPLY_COUNT
		FROM FIND F
		JOIN MEMBER M ON (M.MEMBER_ID =
		F.MEMBER_ID)
		LEFT JOIN FATTACHMENT FA ON (FA.FIND_NO = F.FIND_NO)
		LEFT
		JOIN FIND_REPLY FR ON (FR.FIND_NO = F.FIND_NO)
		WHERE F.STATUS = 'Y'
		AND
		M.MEMBER_ID = #{memberId}
		GROUP BY
		F.FIND_NO,
		F.FIND_TITLE,
		F.FIND_CONTENT,

		F.FIND_CATEGORY,
		F.FIND_VIEW,
		F.FIND_DATE,
		F.STATUS,
		F.MEMBER_ID,
		FA.ORIGIN_NAME,
		FA.CHANGE_NAME
		ORDER BY F.FIND_NO DESC

	</select>







</mapper>